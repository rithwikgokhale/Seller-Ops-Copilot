# Neighborhood-Aware Seller Ops Copilot

An AI-powered insights and recommendations app for small-business sellers. Think "Square Analytics meets a smart assistant" — ask questions in plain English, get data-verified answers with actionable recommendations.

Built as a work-sample for Block/Square's AI-native APM program.

---

## What It Does

A seller (e.g., a coffee-shop owner) can:

1. **Ask natural-language questions** about sales, inventory, staffing, or business performance.
2. **Get structured, data-grounded answers** — never hallucinated numbers:
   - Plain-English summary
   - Key metric cards
   - 1–3 actionable recommendations with confidence levels and assumptions
3. **Toggle Neighborhood Context** to incorporate weather, local events, and review sentiment into the analysis.
4. **Save insights** for later reference.

## Architecture

```
┌────────────┐      POST /api/chat      ┌──────────────────┐
│  React UI  │  ──────────────────────>  │  Express Server  │
│  (Vite)    │  <──────────────────────  │                  │
└────────────┘    CopilotOutput JSON     │  ┌────────────┐  │
                                         │  │  LLM Agent  │  │
                                         │  │  (GPT-4o)   │  │
                                         │  └──────┬─────┘  │
                                         │         │        │
                                         │  ┌──────▼─────┐  │
                                         │  │ Tool Layer  │  │
                                         │  │ (6 tools)   │  │
                                         │  └──────┬─────┘  │
                                         │         │        │
                                         │  ┌──────▼─────┐  │
                                         │  │ Stub Data   │  │
                                         │  │ (JSON files) │  │
                                         │  └────────────┘  │
                                         └──────────────────┘
```

### Key Design Decisions

| Decision | Rationale |
|----------|-----------|
| **Tool-calling over raw SQL** | Model calls typed tools (`getSalesSummary`, `getTopItems`, etc.) instead of writing SQL. Every number is traceable to a tool output — eliminates hallucination. |
| **Zod output schema** | Final LLM output is parsed and validated against a strict Zod schema. Invalid responses throw immediately. |
| **Stubbed JSON data** | Runs fully offline for demos. Data generated by a deterministic seed script (`server/src/data/seed.cjs`). |
| **Neighborhood context as a toggle** | Cleanly separates internal analytics from external signals. The LLM is instructed to never call `getNeighborhoodContext` when the toggle is off. |

## Tech Stack

| Layer | Technology |
|-------|------------|
| Frontend | React 19, TypeScript, Vite, Tailwind CSS |
| Backend | Node.js, Express, TypeScript |
| AI | OpenAI GPT-4o (function calling / tool use) |
| Schema | Zod (shared output validation) |
| Data | Stubbed JSON (30 days of realistic coffee-shop data) |

---

## Quick Start

### Prerequisites

- **Node.js** >= 18
- **OpenAI API key** (GPT-4o access)

### Setup

```bash
# 1. Clone and enter the directory
cd seller-ops-copilot

# 2. Install all dependencies (root + server + client)
npm install

# 3. Set your API key
cp .env.example .env
# Edit .env and add your OPENAI_API_KEY

# 4. (Optional) Regenerate stub data
npm run seed

# 5. Start dev servers (Express on :3001, Vite on :5173)
npm run dev
```

Open **http://localhost:5173** in your browser.

---

## Demo Script

Use these questions to walk through the app's capabilities:

### 1. Basic Sales Overview
> "How were my sales this past week?"

Shows: revenue, order count, avg order value metrics. Recommendations based on trends.

### 2. Top Items Analysis
> "What are my top 5 best-selling items by revenue?"

Shows: ranked item list with quantities and revenue.

### 3. Inventory Check
> "Do I have any inventory issues I should worry about?"

Shows: low-stock alerts, days-until-stockout estimates, reorder recommendations.

### 4. Staffing Signals
> "Am I properly staffed during peak hours?"

Shows: understaffing/overstaffing analysis, orders-per-staff-member during peaks.

### 5. Neighborhood Context (enable the toggle first)
> "How might weather and local events affect my business this week?"

Shows: weather-adjusted demand forecasts, event-driven traffic predictions, review sentiment overlay.

### 6. Save an Insight
Click **Save Insight** on any result, then navigate to the **Saved** tab to see it.

---

## Available Tools

The LLM has access to these tools (implemented in `server/src/tools.ts`):

| Tool | Description |
|------|-------------|
| `getSalesSummary(start, end)` | Revenue, orders, AOV for a date range |
| `getHourlySales(start, end)` | Hourly breakdown with peak identification |
| `getTopItems(start, end, limit, sortBy)` | Top items by revenue or quantity |
| `getInventoryStatus()` | Current stock levels and low-stock alerts |
| `getStaffingSignals(start, end)` | Staff coverage vs. peak traffic analysis |
| `getNeighborhoodContext(start, end)` | Weather, events, review sentiment (gated by toggle) |

## Project Structure

```
├── package.json               # Root scripts (dev, seed, install)
├── .env.example               # Environment template
├── server/
│   ├── src/
│   │   ├── index.ts           # Express server entry point
│   │   ├── agent.ts           # LLM agent loop (tool calling)
│   │   ├── tools.ts           # Tool implementations
│   │   ├── toolDefs.ts        # OpenAI function definitions
│   │   ├── systemPrompt.ts    # System prompt text
│   │   ├── outputSchema.ts    # Zod output schema
│   │   └── data/              # Stub JSON data + seed script
│   └── package.json
├── client/
│   ├── src/
│   │   ├── App.tsx            # Router + layout
│   │   ├── pages/
│   │   │   ├── ChatPage.tsx   # Main chat interface
│   │   │   └── SavedPage.tsx  # Saved insights page
│   │   ├── components/        # Reusable UI components
│   │   ├── hooks/             # Custom hooks (saved insights)
│   │   ├── api.ts             # API client
│   │   └── types.ts           # Shared TypeScript types
│   └── package.json
└── README.md
```

## Non-Goals (for MVP)

- Real database / real Square API integration
- Multi-turn conversation memory (each question is independent)
- User authentication
- Production deployment (this is a demo)

## Roadmap (Post-MVP)

- [ ] Real Square API integration behind a feature flag
- [ ] Evaluation harness: golden-answer test suite for tool-calling accuracy
- [ ] Streaming responses (SSE) for perceived latency improvement
- [ ] Multi-turn conversation with context window management
- [ ] Export insights as PDF/email
- [ ] Real neighborhood APIs (OpenWeather, Yelp Fusion, Eventbrite)

---

## License

MIT
